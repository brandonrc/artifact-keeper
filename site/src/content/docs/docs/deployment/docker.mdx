---
title: "Docker Compose Deployment"
description: "Deploy Artifact Keeper using Docker Compose with all services"
---

Deploy Artifact Keeper using Docker Compose for a complete, containerized setup.

## Prerequisites

- Docker 20.10+ and Docker Compose 2.0+
- 4 GB RAM minimum (8 GB recommended)
- 100 GB disk space for artifacts

## Quick Start

### 1. Clone Repository

```bash
git clone https://github.com/artifact-keeper/artifact-keeper.git
cd artifact-keeper
```

### 2. Start Services

```bash
docker compose up -d
```

### 3. Verify Deployment

```bash
# Check service status
docker compose ps

# Health check
curl http://localhost:30080/health

# Access web UI
open http://localhost:30080

# Login: admin / admin
```

## Architecture

The default `docker-compose.yml` runs these services:

| Service | Image | Port | Description |
|---------|-------|------|-------------|
| **Backend** | `ghcr.io/artifact-keeper/artifact-keeper-backend` | 8080 (internal) | Rust API server |
| **Web UI** | `ghcr.io/artifact-keeper/artifact-keeper-web` | 3000 (internal) | Next.js frontend |
| **Caddy** | `caddy:2-alpine` | **30080** (HTTP), **30443** (HTTPS) | Reverse proxy |
| **PostgreSQL** | `postgres:16-alpine` | 30432 | Metadata database |
| **Meilisearch** | `getmeili/meilisearch:v1.12` | 7700 | Full-text search |
| **Trivy** | `aquasec/trivy:latest` | 8090 | Vulnerability scanning |

Caddy routes:
- `/api/*` and `/health` → Backend (port 8080)
- Everything else → Web UI (port 3000)

## Production Configuration

### Environment Variables

Create a `.env` file in the project root:

```bash
# Security (REQUIRED for production)
JWT_SECRET=your-secure-64-char-secret-here
ADMIN_PASSWORD=your-secure-admin-password

# Caddy — set your domain for automatic Let's Encrypt TLS
SITE_ADDRESS=registry.example.com

# Custom ports (optional)
HTTP_PORT=80
HTTPS_PORT=443

# Logging
RUST_LOG=info

# CORS
CORS_ORIGINS=https://registry.example.com
```

Generate secure secrets:

```bash
openssl rand -base64 64   # JWT secret
openssl rand -base64 32   # Admin password
```

### With S3 Storage

Add S3-compatible storage to the backend environment in `docker-compose.yml`:

```yaml
services:
  backend:
    environment:
      STORAGE_BACKEND: s3
      S3_ENDPOINT: https://s3.amazonaws.com
      S3_BUCKET: artifact-keeper
      S3_REGION: us-east-1
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
```

Works with AWS S3, MinIO, DigitalOcean Spaces, and other S3-compatible services.

### With OpenSCAP Scanning

Enable OpenSCAP compliance scanning (requires local build):

```bash
docker compose --profile scanning up -d
```

## Managing Services

### Start / Stop

```bash
# Start all services
docker compose up -d

# Stop all services
docker compose down

# Stop and remove volumes (WARNING: deletes all data)
docker compose down -v
```

### View Logs

```bash
# All services
docker compose logs -f

# Specific service
docker compose logs -f backend

# Last 100 lines
docker compose logs --tail=100 backend
```

### Update to Latest

```bash
docker compose pull
docker compose up -d
```

## Data Persistence

All data is stored in Docker named volumes:

| Volume | Contents |
|--------|----------|
| `postgres_data` | Database (users, repositories, metadata) |
| `artifact_storage` | Uploaded artifacts |
| `backup_storage` | Automated backups |
| `meilisearch_data` | Search indexes |
| `trivy_cache` | Vulnerability database cache |
| `caddy_data` | TLS certificates |

### Backup Database

```bash
docker compose exec postgres pg_dump -U registry artifact_registry | gzip > backup.sql.gz
```

### Restore Database

```bash
gunzip < backup.sql.gz | docker compose exec -T postgres psql -U registry artifact_registry
```

### Backup Artifacts

```bash
docker run --rm \
  -v artifact-keeper_artifact_storage:/data \
  -v $(pwd):/backup \
  alpine tar czf /backup/artifacts-backup.tar.gz /data
```

## Health Checks

```bash
# All services
docker compose ps

# Backend health (detailed)
curl -s http://localhost:30080/health | jq

# Database
docker compose exec postgres pg_isready -U registry

# Meilisearch
curl -s http://localhost:7700/health | jq
```

## Troubleshooting

### Services Won't Start

```bash
docker compose logs
docker compose config   # Verify environment variables
```

### Port Conflicts

Change ports in `.env`:

```bash
HTTP_PORT=8080
HTTPS_PORT=8443
```

### Out of Disk Space

```bash
docker system df -v      # Check Docker disk usage
docker system prune -a   # Clean unused images/containers
```

## Production Checklist

- [ ] Set strong `JWT_SECRET` (64+ characters)
- [ ] Set `ADMIN_PASSWORD` and change default after first login
- [ ] Set `SITE_ADDRESS` to your domain for auto-TLS
- [ ] Configure S3 or persistent volume for artifact storage
- [ ] Set up automated database backups
- [ ] Configure log rotation
- [ ] Set resource limits (`deploy.resources` in compose)
- [ ] Configure firewall rules
- [ ] Set up monitoring and alerting
